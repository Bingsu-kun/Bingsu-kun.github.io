<!DOCTYPE html><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Cpu Stress Test -1 | HEPHAI's devlog</title><meta name="author" content="Hephai (JangHoon Lee)"><meta name="description" content="Mainly about coding, also my hobbys."><meta property="og:title" content="Cpu Stress Test -1 | HEPHAI's devlog"><meta property="og:url" content="http://localhost:4000/2021/03/03/Cpu-Stress-Test/"><meta property="og:site_name" content="HEPHAI's devlog"><meta property="og:description" content="Mainly about coding, also my hobbys."><meta property="og:image" content="https://res.cloudinary.com/danhdvla9/image/upload/v1615614663/Thumbnails/cpu_cieppp.jpg"><meta property="og:type" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:description" content="Mainly about coding, also my hobbys."><meta name="twitter:title" content="Cpu Stress Test -1 | HEPHAI's devlog"><meta name="twitter:url" content="http://localhost:4000/2021/03/03/Cpu-Stress-Test/"><meta name="twitter:site" content="HEPHAI's devlog"><meta name="twitter:creator" content="@"><meta name="twitter:domain" content="http://localhost:4000"><meta property="twitter:image" content="https://res.cloudinary.com/danhdvla9/image/upload/v1615614663/Thumbnails/cpu_cieppp.jpg"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata|Lora|Space+Mono:700"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" href="/assets/css/main.css"><link rel="alternate" type="application/rss+xml" title="HEPHAI's devlog" href="http://localhost:4000/feed.xml"><link rel="canonical" href="http://localhost:4000/2021/03/03/Cpu-Stress-Test/"></head><main><article itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><header class="section-padding--lg mast rellax" data-rellax-speed="-4"> <a class="nav nav--white" href="/"> <i class="fa fa-lg fa-arrow-left"></i> <span>Back to Posts</span> </a><figure class="absolute-bg mast__img" style="background-image: url('https://res.cloudinary.com/danhdvla9/image/upload/v1615614663/Thumbnails/cpu_cieppp.jpg');"></figure><div class="mast__container"> <span><time datetime="2021-03-03T00:00:00+09:00" itemprop="datePublished">Mar 3, 2021</time></span><h1 itemprop="name headline">Cpu Stress Test -1</h1><span>Posted in <a class="nav--white" href="/category/back-end-study">Back-End-Study</a> </span> <span></span></div></header><section class="section-padding bg-grey" itemprop="articleBody"><div class="post"><p><br /> <br /></p><h4 id="목차">목차</h4><p><br /> <br /></p><ul><li>I/O Burst, I/O Bound VS CPU Burst, CPU Bound</li><li>Hash를 이용해서 CPU를 극단적으로 사용하기 (feat. Spring Boot)</li><li>GCP 인스턴스에 배포</li></ul><p><br /> <br /></p><hr /><p><br /> <br /></p><h4 id="io-burst-io-bound-vs-cpu-burst-cpu-bound">I/O Burst, I/O Bound VS Cpu Burst, Cpu Bound</h4><p><br /> <br /></p><p>I/O Burst와 I/O Bound는 무엇이고, Cpu Burst와 Cpu Bound는 무엇일까?</p><p><br /></p><p>이를 설명하기 위해서는 우선 프로세스가 처리되는 과정을 먼저 알아야한다. 그 전에 프로그램과 프로세스의 차이점부터 짚고 넘어가자.</p><p><br /></p><p><strong>프로그램</strong> : 하드에 저장되어 있는 Application <br /> <strong>프로세스</strong> : 메모리에 적재되어 있는 프로그램</p><p><br /> <br /></p><p>이렇게 메모리에 적재되어 처리를 기다리고 있는 프로세스들을 처리하는 순서를 <strong>프로세스 스케줄링</strong>이라 한다.</p><p><br /></p><p>이 프로세스 스케줄링에 따라 프로세스들은 CPU에 의해 처리되는데, 이 때 CPU에 I/O(input/output)되는 시간을 <strong>I/O Burst</strong>, CPU가 프로세스를 처리하는 시간을 <strong>CPU Burst</strong>라고 한다.</p><p><br /></p><p>그리고 I/O Burst가 큰 프로그램을 <strong>I/O Bound</strong>, CPU Burst가 큰 프로그램을 <strong>CPU Bound</strong>라고 한다.</p><p><br /> <br /></p><p>나는 GCP CPU 테스트를 위해 CPU Burst가 높은 간단한 프로그램을 만들었다.</p><p><br /> <br /> <br /> <br /></p><h4 id="hash를-이용해서-cpu를-극단적으로-사용하기">Hash를 이용해서 CPU를 극단적으로 사용하기</h4><p><br /> <br /></p><p>아래와 같은 코드를 참조하여 hash (md5)를 이용하는 프로그램을 작성하였다.</p><p>hash가 무엇인지 궁금하다면?</p><p><a href="https://medium.com/@yeon22/crypto-%ED%95%B4%EC%8B%9C-hash-%EB%9E%80-6962be197523">해시에 대해</a></p><p><br /></p><p>’'’java import org.springframework.web.bind.annotation.PathVariable; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RestController;</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import javax.xml.bind.DatatypeConverter;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

@RestController
public class HashController {

	@RequestMapping("/hash/{input}")
	public String getDigest(@PathVariable("input") String input) throws NoSuchAlgorithmException {
	    for(int i = 0; i &lt; 100_000; i++) {
	        input = getMD5Digest(input);
	    }
	    return input;
	}

	@RequestMapping("/hello")
	public String hello() {
	    return "hello";
	}

	private String getMD5Digest(String input) throws NoSuchAlgorithmException {
	    MessageDigest md = MessageDigest.getInstance("MD5");
	    md.update(input.getBytes());
	    byte[] digest = md.digest();
	    String myHash = DatatypeConverter
	            .printHexBinary(digest).toUpperCase();

	    return myHash;
	}
} '''
</code></pre></div></div><p><br /></p><p>참조 : https://github.com/lleellee0/cpu-bound-application <br /> –추가사항 : 충돌 방지를 위해 application.properties 파일에서 server.port 를 80으로 설정해줘야 한다. <br /></p><p><br /></p><p>/hash/{input} 과 /hello 두 가지 매핑이 있고, input에 들어온 문자열을 10만번 해시 연산한 결과를 반환한다.</p><p><br /></p><hr /><p>ERROR FIX</p><hr /><p><br /></p><p>JDK8이 아닌 다른 버전을 쓸 경우 DataTypeConverter를 찾지 못하는 오류가 있었다.</p><p>나는 11로 하고 있었기 때문에 해당 패키지가 제외되어있던 상태라 의존성을 추가해주어야 했다.</p><p>’'’xml <dependency> <groupId>javax.xml.bind</groupId> <artifactId>jaxb-api</artifactId> <version>2.3.1</version> </dependency> ‘’’</p><p><br /></p><h4 id="gcp-인스턴스에-배포">GCP 인스턴스에 배포</h4><p><br /></p><p>1 intelliJ 우측에서 maven 탭을 통해 .jar 파일을 만든다. (Maven -&gt; Lifecycle -&gt; deploy 더블클릭으로 생성!)</p><p><br /></p><blockquote><p>익숙했던 maven 이지만 처음 알았던 내용인 만큼 조금 충격이었달까… 그동안 배포를 한번도 안해봐서 .jar 파일을 만들 생각도, 만들어 볼 못했지만 이렇게해서 배포가 이루어 진다는 것을 배웠을 때 굉장히 희열을 느꼈다. ( <del>생각해보니까 패키지 매니저인데 의존성 관리만 하고 패키징을 제대로 해본 적이 없었네…</del> )</p></blockquote><p><br /></p><p>2 깃허브 Repo에 push.</p><p><br /></p><p>3 GCP 인스턴스에 가서 wget [repo에 저장된 .jar파일 주소]을 사용해 인스턴스에 다운로드.</p><p><br /></p><ul><li>나는 CentOS를 설치했기 때문에 yum install wget을 통해 wget 설치하였다. <br /></li><li>GCP 는 한 계정당 3달간 300달러 무료 크레딧을 지급한다. 초과 시 과금되니 계정관리 필수 !! <br /></li><li>GCP 인스턴스 생성에 대해서는 생략한다. <br /></li></ul><p><br /></p><p>4 sudo java -jar [다운받은 .jar 파일명] 명령어를 통해 실행 테스트!</p><p><br /> <br /></p><p><img src="https://res.cloudinary.com/danhdvla9/image/upload/v1614939147/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7_2021-03-05_19-07-13_m3hhzt.png" alt="GCP instance" title="구동테스트" /></p><p>정상적으로 실행되는 모습이다.</p><p><br /> <br /> <br /> <br /> <br /> <br /></p><p>스트레스 테스트를 위한 과정 중 중간까지 왔다. 이제 준비가 다 되었고 스트레스 테스트하는 일만 남았는데 준비하는 과정만해도 새로이 배우는 것들이 많아서 굉장히 재미있었다. <br /></p><p>다음 포스팅에서는 스트레스 테스트 툴 중 하나인 Artillery를 이용하여 테스트 결과를 출력해보자.</p></div></section><section class="profile"><div class="profile__card"><div class="profile__img"><figure class="absolute-bg" style="background-image: url('https://res.cloudinary.com/danhdvla9/image/upload/v1614694302/Blacksmith_vqd5bz.png');"></figure></div><div class="profile__container"><p>Interested in backend dev, cloud engineering, blockchain. Usually do camping, fishing, cooking, exercising on holiday. And also enjoy editing videos that I took this hobbys.</p><ul class="profile__social"><li><a class="fa fa-lg fa-envelope-o" href="mailto:icetime963@gmail.com"></a></li><li><a class="fa fa-lg fa-github" href="https://github.com/bingsu-kun" target="_blank"></a></li></ul></div></div></section></article><section class="next"> <a class="next__link" href="/2021/03/01/about-me/" style="background-image: url('https://res.cloudinary.com/danhdvla9/image/upload/v1621929092/Thumbnails/bg_dlt1xv.png');"><div class="next__container"> <span>Read Next</span><h2>About me</h2></div></a></section></main><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/rellax/1.0.0/rellax.min.js"></script> <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/wow/1.1.2/wow.min.js"></script> <script type="text/javascript" src="/assets/js/app.js"></script></body></html>
